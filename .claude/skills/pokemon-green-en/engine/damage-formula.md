# 포켓몬 그린 - 데미지 계산 공식 (1세대)

## 기본 공식

```
최종 데미지 = floor(floor(floor(2 × L / 5 + 2) × P × A / D) / 50 + 2) × M
```

### 변수 설명
- **L**: 공격자 레벨
- **P**: 기술 위력 (Power)
- **A**: 공격 능력치 (물리: 공격, 특수: 특수)
- **D**: 방어 능력치 (물리: 방어, 특수: 특수)
- **M**: 보정 배율 (Modifier)

---

## 보정 배율 (Modifier)

```
M = STAB × Type × Critical × Random
```

### STAB (자속보정)
```
STAB = 1.5  (기술 타입 == 사용자 타입)
STAB = 1.0  (그 외)
```

### 타입 상성 (Type)
```
Type = 0    (효과 없음)
Type = 0.5  (효과가 별로)
Type = 1.0  (보통)
Type = 2.0  (효과 굉장함)
Type = 4.0  (2배 × 2배, 복합 타입)
Type = 0.25 (0.5배 × 0.5배, 복합 타입)
```

### 급소 (Critical)
```
Critical = 2.0  (급소 히트)
Critical = 1.0  (보통)
```

### 난수 (Random)
```
Random = rand(217, 255) / 255
```
- 범위: 0.85 ~ 1.0
- 데미지가 1인 경우 난수 적용하지 않음

---

## 물리/특수 분류 (1세대)

### 물리 타입
```
Normal, Fighting, Flying, Poison, Ground, Rock, Bug, Ghost
```
- 사용 스탯: 공격 vs 방어

### 특수 타입
```
Fire, Water, Electric, Grass, Ice, Psychic, Dragon
```
- 사용 스탯: 특수 vs 특수

---

## 급소율 계산 (1세대)

### 기본 급소율
```
급소 확률 = BaseSpeed / 512
```
- BaseSpeed = 종족치 스피드 (진화 후에도 원본 종족치 사용)

### 높은 급소율 기술
```
급소 확률 = BaseSpeed / 64
```
- 해당 기술: 칼등치기(Slash), 태권당수(Karate Chop), 잎날가르기(Razor Leaf), 크랩해머(Crabhammer)

### 포커스 에너지 버그 (1세대)
```
포커스 에너지 사용 시:
급소 확률 = BaseSpeed / 2048  (원래는 증가해야 함, 버그로 감소)
```

### 예시 급소율

| 포켓몬 | 스피드 종족치 | 기본 급소율 | 높은 급소율 |
|--------|-------------|------------|------------|
| 뮤츠 | 130 | 25.4% | 100%+ |
| 프테라 | 130 | 25.4% | 100%+ |
| 쥬피썬더 | 130 | 25.4% | 100%+ |
| 페르시온 | 115 | 22.5% | 100%+ |
| 스타미 | 115 | 22.5% | 100%+ |
| 피카츄 | 90 | 17.6% | 100%+ |
| 꼬부기 | 43 | 8.4% | 67.2% |

---

## 급소 히트 시 특수 규칙

1. **능력치 변화 무시**: 공격/방어 랭크 무시, 원본 스탯으로 계산
2. **리플렉터/빛의장막 무시**: 방어 배율 보정 무시
3. **화상 공격력 감소 무시**: 화상 상태의 공격력 반감 무시

---

## 특수 케이스

### 255 초과 스탯 버그
```
if (Attack > 255 OR Defense > 255):
    Attack = floor(Attack / 4)
    Defense = floor(Defense / 4)
```

### 자폭/대폭발
```
Defense = floor(Defense / 2)  (방어력 절반으로 계산)
```

### 최소 데미지
```
데미지 = max(1, 계산된 데미지)
```

---

## 완전한 계산 예시

### 상황
- 공격자: 피카츄 Lv.25 (공격: 55, 특수: 50)
- 방어자: 꼬부기 Lv.20 (방어: 40, 특수: 48)
- 기술: 10만볼트 (전기, 위력 90)

### 계산
```
1. 기본 스탯 결정
   - 10만볼트 = 전기 타입 = 특수 기술
   - A = 50 (피카츄 특수)
   - D = 48 (꼬부기 특수)

2. 기본 데미지
   = floor(floor(floor(2 × 25 / 5 + 2) × 90 × 50 / 48) / 50 + 2)
   = floor(floor(floor(12) × 90 × 50 / 48) / 50 + 2)
   = floor(floor(1125) / 50 + 2)
   = floor(22.5 + 2)
   = 24

3. 보정 적용
   - STAB = 1.5 (피카츄는 전기 타입)
   - Type = 2.0 (전기 → 물 = 효과 굉장함)
   - Critical = 1.0 (급소 아님)
   - Random = 230/255 = 0.902 (예시)

4. 최종 데미지
   = floor(24 × 1.5 × 2.0 × 1.0 × 0.902)
   = floor(64.944)
   = 64
```

---

## 1세대 버그 목록

### 에스퍼 vs 고스트 버그
```
의도: 에스퍼 → 고스트 = 2배
실제: 에스퍼 → 고스트 = 0배 (면역)
```

### 고스트 vs 에스퍼 버그
```
의도: 고스트 → 에스퍼 = 2배
실제: 고스트 → 에스퍼 = 0배 (면역)
```

### 독 vs 벌레 버그
```
의도: 독 → 벌레 = 1배
실제: 독 → 벌레 = 2배
```

### 포커스 에너지 버그
```
의도: 급소율 증가
실제: 급소율 1/4로 감소
```

### 얼음 상태 해동 버그
```
의도: 불꽃 기술 맞으면 해동
실제: 불꽃 기술 맞아도 해동 안 됨
```

---

## 고정 데미지 기술

### 레벨 기반
```
지구던지기, 나이트헤드:
데미지 = 사용자 레벨
```

### 고정값
```
소닉붐: 데미지 = 20
용의분노: 데미지 = 40
```

### 일격필살
```
뿔드릴, 가위자르기, 땅가르기:
명중 시 상대 HP = 0
명중률 = (사용자 레벨 - 상대 레벨 + 30)%
상대 레벨 > 사용자 레벨: 항상 실패
```

---

## 반동/흡수 데미지

### 반동
```
돌진, 이판사판태클: 반동 = 데미지 / 4
자폭: 사용자 기절
대폭발: 사용자 기절
```

### 흡수
```
흡수, 메가드레인, 씨뿌리기: 회복 = 데미지 / 2
꿈먹기: 회복 = 데미지 / 2 (자는 상대만)
```

---

## 연속 공격 기술

| 기술 | 횟수 | 확률 |
|------|------|------|
| 연속뺨치기 | 2-5회 | 37.5% 2회, 37.5% 3회, 12.5% 4회, 12.5% 5회 |
| 연속펀치 | 2-5회 | 위와 동일 |
| 바늘미사일 | 2-5회 | 위와 동일 |
| 더블니들 | 2회 | 고정 |
| 두번차기 | 2회 | 고정 |
