# 포켓몬 그린 - 포획률 계산 (1세대)

## 개요

1세대 포켓몬의 포획 시스템은 현재 HP, 상태이상, 포켓볼 종류, 그리고 해당 포켓몬의 고유 포획률에 따라 결정됩니다.

---

## 포획 공식

### 1단계: 포획 상태값 계산

```
F = (HP_max × 255 × 4) / (HP_current × Ball)
```

- **HP_max**: 야생 포켓몬 최대 HP
- **HP_current**: 야생 포켓몬 현재 HP
- **Ball**: 볼 수정치 (아래 참조)

### 볼 수정치

| 볼 | 수정치 | 설명 |
|----|--------|------|
| 몬스터볼 | 255 | 기본 볼 |
| 수퍼볼 | 200 | 1.5배 효과 |
| 하이퍼볼 | 150 | 2배 효과 |
| 마스터볼 | - | 무조건 포획 |
| 사파리볼 | 255 | 사파리존 전용 |

---

### 2단계: 포획 확률 계산

```
M = floor(CatchRate × F / 255)

if M ≥ 256:
    포획 성공 (흔들림 없이 즉시)
```

- **CatchRate**: 포켓몬 고유 포획률 (3~255)

---

### 3단계: 흔들림 체크

M < 256인 경우, 4번의 흔들림 체크를 수행합니다.

```
ShakeChance = CatchRate × 100 / Ball

각 흔들림:
if rand(0, 65535) < ShakeChance:
    다음 흔들림으로
else:
    빠져나옴
```

4번 모두 성공하면 포획 완료.

---

## 상태이상 보정

### 적용 방법
상태이상이 있는 포켓몬은 포획률에 보정이 적용됩니다.

```
상태이상 보정 (StatusBonus):
- 잠듦, 얼음: CatchRate × 2
- 마비, 화상, 독: CatchRate × 1.5
- 정상: CatchRate × 1.0
```

실제 계산:
```
EffectiveCatchRate = min(255, floor(CatchRate × StatusBonus))
```

---

## 포켓몬별 포획률

### 매우 낮음 (3)
- 뮤츠, 프리져, 썬더, 파이어, 뮤

### 낮음 (25~45)
- 스타터 3종 (45)
- 망나뇽 진화 라인 (45)
- 갸라도스 (45)
- 라프라스 (45)
- 잠만보 (25)

### 보통 (50~120)
- 대부분의 일반 포켓몬

### 높음 (190~255)
- 구구, 꼬렛, 캐터피, 뿔충이 등 초반 포켓몬
- 잉어킹 (255)

---

## 예시 계산

### 상황
- 야생 피카츄 (포획률: 190)
- 최대 HP: 35, 현재 HP: 10
- 상태: 마비
- 사용 볼: 수퍼볼

### 계산

```
1. 상태이상 보정
   EffectiveCatchRate = min(255, floor(190 × 1.5)) = 255

2. 포획 상태값
   F = (35 × 255 × 4) / (10 × 200)
   F = 35700 / 2000
   F = 17.85

3. 포획 확률
   M = floor(255 × 17.85 / 255)
   M = floor(17.85)
   M = 17

4. 흔들림 체크
   ShakeChance = 255 × 100 / 200 = 127.5

   각 흔들림당 성공 확률: 127.5 / 65536 × 65536 = 127.5 (약 0.2%)

   실제로는 더 복잡한 계산이지만,
   대략 4번 연속 성공 확률은 상당히 낮음
```

---

## 사파리존 특수 규칙

### 행동 선택지
- 볼 던지기
- 먹이 주기: 도주율 감소, 포획률 감소
- 돌 던지기: 도주율 증가, 포획률 증가
- 도망가기

### 수정된 공식
```
CatchValue = CatchRate × 100 / (Ball + CatchBonus)
EscapeValue = BaseEscapeRate × (EscapeModifier)
```

---

## 포획 성공 시 메시지 시퀀스

```
"{player}은(는) {ball}을(를) 던졌다!"

[흔들림 0회 빠져나옴]
"아! 빠져나왔다!"

[흔들림 1회]
"흔들 흔들..."
[빠져나옴]
"아! 빠져나왔다!"

[흔들림 2회]
"흔들 흔들..."
"흔들 흔들..."
[빠져나옴]
"아악! 거의 잡을 뻔 했는데!"

[흔들림 3회]
"흔들 흔들..."
"흔들 흔들..."
"흔들 흔들..."
[빠져나옴]
"으악! 아깝다!"

[포획 성공]
"흔들 흔들..."
"흔들 흔들..."
"흔들 흔들..."
"딱!"
"신난다! {pokemon}을(를) 잡았다!"
```

---

## 마스터볼

```
if 볼 == 마스터볼:
    즉시 포획 성공
    흔들림 체크 없음
```

### 획득 방법
- 실프주식회사 사장에게 받음 (스토리 진행)
- 1개만 획득 가능

### 권장 사용처
- 뮤츠 (포획률 3)
- 전설의 새 (포획률 3)
- 도주하는 포켓몬

---

## 도감 등록

포획 성공 시:
1. 도감 "잡은 포켓몬"에 등록
2. 이미 "본 포켓몬"에 있으면 "잡은 포켓몬"으로 업그레이드
3. 처음 보는 포켓몬이면 "본 포켓몬"과 "잡은 포켓몬" 동시 등록

---

## 파티/PC 처리

### 파티에 빈 자리 있음 (< 6마리)
```
잡은 {pokemon}을(를) 파티에 추가했다!
```

### 파티 가득 참 (6마리)
```
잡은 {pokemon}을(를) PC에 전송했다!
현재 박스: {box_name}
```

### 별명 짓기
```
"{pokemon}에게 별명을 붙이시겠습니까?"
[예] → 별명 입력
[아니오] → 종 이름 사용
```
